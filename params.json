{"name":"damidseq_pipeline","tagline":"An automated pipeline for processing DamID sequencing datasets","body":"### Introduction\r\n\r\nProcessing DamID-seq data involves extending single-end reads, aligning the reads to the genome and determining the coverage, similar to processing regular ChIP-seq datasets. However, as DamID data is represented as a log2 ratio of (Dam-fusion/Dam), normalisation of the sample and Dam-only control is necessary, and adding pseudocounts to mitigate the effect of background counts when represented as a ratio is highly recommended.\r\n\r\nWe use a single pipeline script to handle alignment, read extension, binned counts, normalisation, pseudocount addition and final ratio file generation. The script uses .fastq files as input, and outputs the final log2 ratio files in GFF or BEDGRAPH format. These files can easily be converted to TDF for viewing in [IGV](www.broadinstitute.org/software/igv/) with the provided gff2tdf.pl script (see below).\r\n\r\n### Download\r\n\r\nClick on the links above to download the latest version of the pipeline script and associated files.\r\n\r\n### Requirements\r\n\r\n* [Bowtie 2](bowtie-bio.sourceforge.net/bowtie2/index.shtml) v2.1 or above (and appropriate genome indices -- see below) (not required if using pre-aligned BAM files)\r\n* [SAMtools](samtools.sourceforge.net) v0.1.9 or above\r\n* a GFF file containing all GATC sites in the genome (a file for the Drosophila genome is provided in the script .zip archive)\r\n* a *nix operating system (e.g. linux, Mac OSX) with Perl v5.10 or greater installed. We recommend using Ubuntu Linux in a virtual machine if using Windows.\r\n* Sequencing data in FASTQ or BAM format\r\n\r\n### Installation\r\n\r\n1. Unzip the pipeline script zip file, make the damid_pipeline.pl file executable and place it in your path\r\n1. Install Bowtie 2\r\n1. Obtain Bowtie 2 indices provided by [Bowtie 2](bowtie-bio.sourceforge.net/bowtie2/index.shtml) or [Illumina's iGenome](support.illumina.com/sequencing/sequencing_software/igenome.html)\r\n\r\n    Alternatively, build the Bowtie 2 index files manually:\r\n    1. Download the latest FASTA genome primary_assembly (or toplevel) file from [Ensembl](ftp.ensembl.org/pub/current_fasta/)\r\n        e.g. [the current release for *Mus musculus*](ftp.ensembl.org/pub/current_fasta/mus_musculus/dna/Mus_musculus.GRCm38.dna.primary_assembly.fa.gz)\r\n        \r\n        (alternatively, for *Drosophila*, download from the [Flybase FTP site](ftp.flybase.net/releases/current/)\r\n         e.g. [*D. melanogaster* release 5.57](ftp.flybase.net/releases/FB2014_03/dmel_r5.57/fasta/dmel-all-chromosome-r5.57.fasta.gz))\r\n    1. Extract the .gz file\r\n    1. Run bowtie2-build in the directory containing the extracted .fasta file. For the examples above:\r\n\r\n            bowtie2-build dmel-all-chromosome-r5.57.fasta dmel_r5.57\r\n            bowtie2-build dmel-all-chromosome-r5.57.fasta dmel_r5.57\r\n1. Install SAMtools\r\n1. Install the pre-supplied GATC location files, or build your own:\r\n    1. Download the FASTA genome sequence, as in step 4 above (no need to extract the gzipped files)\r\n    1. Run the provided gatc.track.maker.pl script on the fasta sequence, e.g.:\r\n\r\n            perl gatc.track.maker.pl --name=dmel_r5.57 dmel-all-chromosome-r5.57.fasta\r\n\r\n### Running the script the first time\r\n\r\nIn order to run correctly, the script needs to know the locations of two paths, specified using the following command-line options:\r\n\r\n1. The directory and basename of the bowtie2 index files (obtained or built in steps 3 and 4 above)\r\n    (specified with the --bowtie2_genome_dir option)\r\n        e.g. in the example above, use\r\n\r\n        --bowtie2_genome_dir=[path_to_.bt2_files]/dmel_r5.57\r\n1. The GATC fragment .gff file (provided in the zip file, or built in step 6 above)\r\n    (specified with the --gatc_frag_file option)\r\n\r\nIn order to setup the pipeline to process the *D. melanogaster* genome, for example, the first-run command would be:\r\n\r\n    damidseq_pipeline.pl --gatc_frag_file=path/to/Dmel_r5.57.GATC.gff.gz --bowtie2_genome_dir=path/to/dmel_r5.57/dmel_r.5.57\r\n\r\nIf these paths do not already exist and the script is run with these options and correct values, the paths will be saved for all future runs unless overridden on the command-line.\r\n\r\n(To clear all user-saved values, run the script with the --reset_defaults option.)\r\n\r\n###Running the script\r\n\r\nRun the script in a directory with sequencing files in FASTQ or BAM format.  The default behaviour is to process all files in FASTQ format, and if none are found, all files in BAM format.  Alternatively, individual files may be specified on the command line if the user does not wish to process all available files present in the directory (for example, if the sequencing lane contained multiple replicates).\r\n\r\nThe script will by default determine sample names from the file names, and expects a single filename to start with \"Dam\" in order to automatically assign the Dam-only control.\r\n\r\nRunning the script with --help will give you a list of adjustable parameters and their default settings. We recommend keeping these at the default value in most cases; however, these can be modified on the command-line with --option=value (no spaces).\r\n\r\nTo save modified values for all future runs, run the script with the parameter you wish to change together with the --save_defaults command-line option.\r\n\r\nIf bowtie2 and samtools are not in your path, you can specify these on the command-line also.\r\n\r\n#### Working with multiple genomes\r\n\r\nIf the user expects to process data from multiple genomes, separate genome specifications can be saved by using the --save_defaults=[name] along with --bowtie2_genome_dir and --gatc_frag_file.\r\n\r\nOnce set up, different genome definitions can be quickly loaded using the --load_defaults=[name] option.  All currently saved genome definitions can be listed using --load_defaults=list.\r\n\r\n#### Processing FASTQ files with adaptor codes\r\n\r\nThe damidseq_pipeline will attempt to automatically determine the sample name from the filenames provided.  \r\n\r\nSome sequencing facilities, however, may provide only adaptor index IDs rather than sample names.  If sequencing filenames are provided with index IDs rather than names, a file \"index.txt\" in the working directory can be provided with the format of [index] [sample_name], eg:\r\n\r\n    A6 Dam\r\n    A12 polII \r\n\r\nwhere A6 is the sequencing adaptor index. The sample name cannot contain spaces and there has to be one (and only one) sample called \"Dam\"; the adaptor index must to be referenced in the fastq filename (e.g. for \"A6\", either \"Index6\" or \"A006\" are expected in the filename). Please see the [provided example](github.com/owenjm/damid_pipeline/blob/master/example.zip?raw=true) for an illustration of the index.txt file format and matching file names.\r\n\r\n### Example dataset\r\n\r\nAn example set of two small (3000 reads each) fastq.gz files and an index.txt file are provided in the zip archive (as \"example.zip\"), or you can [download these separately](github.com/owenjm/damid_pipeline/blob/master/example.zip?raw=true). Running the pipeline script on these files should successfully produce a polII-vs-Dam.gff ratio file as output.\r\n\r\n### Output\r\n\r\nThe final output will be two ratio files: Sample-vs-DAM.gff and Sample-vs-DAM.gatc.gff. The .gatc.gff file represents the GATC fragments (based on the reference genome) and should be used for all subsequent analysis. The other ratio file contains the coverageBed bins (i.e. 75nt bins by default) and may be useful for data representation.\r\n\r\nThe pipeline script can output the final ratio files in BedGraph format if the --bedgraph command-line switch is used.\r\n\r\nEither file can be converted to .tdf format for viewing in IGV via the gff2tdf.pl script.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}