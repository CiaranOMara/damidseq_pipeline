<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>damidseq_pipeline by owenjm</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>damidseq_pipeline</h1>
        <p>An automated pipeline for processing DamID sequencing datasets</p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/owenjm/damidseq_pipeline" class="button fork"><strong>View On GitHub</strong></a>
        <div class="downloads">
          <span>Downloads:</span>
          <ul>
            <li><a href="https://github.com/owenjm/damidseq_pipeline/zipball/master" class="button">ZIP</a></li>
            <li><a href="https://github.com/owenjm/damidseq_pipeline/tarball/master" class="button">TAR</a></li>
          </ul>
        </div>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <h3>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h3>

<p>Processing DamID-seq data involves extending single-end reads, aligning the reads to the genome and determining the coverage, similar to processing regular ChIP-seq datasets. However, as DamID data is represented as a log2 ratio of (Dam-fusion/Dam), normalisation of the sample and Dam-only control is necessary, and adding pseudocounts to mitigate the effect of background counts when represented as a ratio is highly recommended.</p>

<p>We use a single pipeline script to handle alignment, read extension, binned counts, normalisation, pseudocount addition and final ratio file generation. The script uses .fastq files as input, and outputs the final log2 ratio files in GFF or BEDGRAPH format. These files can easily be converted to TDF for viewing in <a href="www.broadinstitute.org/software/igv/">IGV</a> with the provided gff2tdf.pl script (see below).</p>

<h3>
<a id="download" class="anchor" href="#download" aria-hidden="true"><span class="octicon octicon-link"></span></a>Download</h3>

<p>Click on the links above to download the latest version of the pipeline script and associated files.</p>

<h3>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Requirements</h3>

<ul>
<li>
<a href="bowtie-bio.sourceforge.net/bowtie2/index.shtml">Bowtie 2</a> v2.1 or above (and appropriate genome indices -- see below) (not required if using pre-aligned BAM files)</li>
<li>
<a href="samtools.sourceforge.net">SAMtools</a> v0.1.9 or above</li>
<li>a GFF file containing all GATC sites in the genome (a file for the Drosophila genome is provided in the script .zip archive)</li>
<li>a *nix operating system (e.g. linux, Mac OSX) with Perl v5.10 or greater installed. We recommend using Ubuntu Linux in a virtual machine if using Windows.</li>
<li>Sequencing data in FASTQ or BAM format</li>
</ul>

<h3>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h3>

<ol>
<li>Unzip the pipeline script zip file, make the damid_pipeline.pl file executable and place it in your path</li>
<li>Install Bowtie 2</li>
<li>
<p>Obtain Bowtie 2 indices provided by <a href="bowtie-bio.sourceforge.net/bowtie2/index.shtml">Bowtie 2</a> or <a href="support.illumina.com/sequencing/sequencing_software/igenome.html">Illumina's iGenome</a></p>

<p>Alternatively, build the Bowtie 2 index files manually:</p>

<ol>
<li>
<p>Download the latest FASTA genome primary_assembly (or toplevel) file from <a href="ftp.ensembl.org/pub/current_fasta/">Ensembl</a>
e.g. <a href="ftp.ensembl.org/pub/current_fasta/mus_musculus/dna/Mus_musculus.GRCm38.dna.primary_assembly.fa.gz">the current release for <em>Mus musculus</em></a></p>

<p>(alternatively, for <em>Drosophila</em>, download from the <a href="ftp.flybase.net/releases/current/">Flybase FTP site</a>
 e.g. <a href="ftp.flybase.net/releases/FB2014_03/dmel_r5.57/fasta/dmel-all-chromosome-r5.57.fasta.gz"><em>D. melanogaster</em> release 5.57</a>)</p>
</li>
<li>Extract the .gz file</li>
<li>
<p>Run bowtie2-build in the directory containing the extracted .fasta file. For the examples above:</p>

<pre><code>bowtie2-build dmel-all-chromosome-r5.57.fasta dmel_r5.57
bowtie2-build dmel-all-chromosome-r5.57.fasta dmel_r5.57
</code></pre>
</li>
</ol>
</li>
<li>Install SAMtools</li>
<li>
<p>Install the pre-supplied GATC location files, or build your own:</p>

<ol>
<li>Download the FASTA genome sequence, as in step 4 above (no need to extract the gzipped files)</li>
<li>
<p>Run the provided gatc.track.maker.pl script on the fasta sequence, e.g.:</p>

<pre><code>perl gatc.track.maker.pl --name=dmel_r5.57 dmel-all-chromosome-r5.57.fasta
</code></pre>
</li>
</ol>
</li>
</ol>

<h3>
<a id="running-the-script-the-first-time" class="anchor" href="#running-the-script-the-first-time" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running the script the first time</h3>

<p>In order to run correctly, the script needs to know the locations of two paths, specified using the following command-line options:</p>

<ol>
<li>
<p>The directory and basename of the bowtie2 index files (obtained or built in steps 3 and 4 above)
(specified with the --bowtie2_genome_dir option)
    e.g. in the example above, use</p>

<pre><code>--bowtie2_genome_dir=[path_to_.bt2_files]/dmel_r5.57
</code></pre>
</li>
<li>The GATC fragment .gff file (provided in the zip file, or built in step 6 above)
(specified with the --gatc_frag_file option)</li>
</ol>

<p>In order to setup the pipeline to process the <em>D. melanogaster</em> genome, for example, the first-run command would be:</p>

<pre><code>damidseq_pipeline.pl --gatc_frag_file=path/to/Dmel_r5.57.GATC.gff.gz --bowtie2_genome_dir=path/to/dmel_r5.57/dmel_r.5.57
</code></pre>

<p>If these paths do not already exist and the script is run with these options and correct values, the paths will be saved for all future runs unless overridden on the command-line.</p>

<p>(To clear all user-saved values, run the script with the --reset_defaults option.)</p>

<h3>
<a id="running-the-script" class="anchor" href="#running-the-script" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running the script</h3>

<p>Run the script in a directory with sequencing files in FASTQ or BAM format.  The default behaviour is to process all files in FASTQ format, and if none are found, all files in BAM format.  Alternatively, individual files may be specified on the command line if the user does not wish to process all available files present in the directory (for example, if the sequencing lane contained multiple replicates).</p>

<p>The script will by default determine sample names from the file names, and expects a single filename to start with "Dam" in order to automatically assign the Dam-only control.</p>

<p>Running the script with --help will give you a list of adjustable parameters and their default settings. We recommend keeping these at the default value in most cases; however, these can be modified on the command-line with --option=value (no spaces).</p>

<p>To save modified values for all future runs, run the script with the parameter you wish to change together with the --save_defaults command-line option.</p>

<p>If bowtie2 and samtools are not in your path, you can specify these on the command-line also.</p>

<h4>
<a id="working-with-multiple-genomes" class="anchor" href="#working-with-multiple-genomes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Working with multiple genomes</h4>

<p>If the user expects to process data from multiple genomes, separate genome specifications can be saved by using the --save_defaults=[name] along with --bowtie2_genome_dir and --gatc_frag_file.</p>

<p>Once set up, different genome definitions can be quickly loaded using the --load_defaults=[name] option.  All currently saved genome definitions can be listed using --load_defaults=list.</p>

<h4>
<a id="processing-fastq-files-with-adaptor-codes" class="anchor" href="#processing-fastq-files-with-adaptor-codes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Processing FASTQ files with adaptor codes</h4>

<p>The damidseq_pipeline will attempt to automatically determine the sample name from the filenames provided.  </p>

<p>Some sequencing facilities, however, may provide only adaptor index IDs rather than sample names.  If sequencing filenames are provided with index IDs rather than names, a file "index.txt" in the working directory can be provided with the format of [index] [sample_name], eg:</p>

<pre><code>A6 Dam
A12 polII 
</code></pre>

<p>where A6 is the sequencing adaptor index. The sample name cannot contain spaces and there has to be one (and only one) sample called "Dam"; the adaptor index must to be referenced in the fastq filename (e.g. for "A6", either "Index6" or "A006" are expected in the filename). Please see the <a href="github.com/owenjm/damid_pipeline/blob/master/example.zip?raw=true">provided example</a> for an illustration of the index.txt file format and matching file names.</p>

<h3>
<a id="example-dataset" class="anchor" href="#example-dataset" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example dataset</h3>

<p>An example set of two small (3000 reads each) fastq.gz files and an index.txt file are provided in the zip archive (as "example.zip"), or you can <a href="github.com/owenjm/damid_pipeline/blob/master/example.zip?raw=true">download these separately</a>. Running the pipeline script on these files should successfully produce a polII-vs-Dam.gff ratio file as output.</p>

<h3>
<a id="output" class="anchor" href="#output" aria-hidden="true"><span class="octicon octicon-link"></span></a>Output</h3>

<p>The final output will be two ratio files: Sample-vs-DAM.gff and Sample-vs-DAM.gatc.gff. The .gatc.gff file represents the GATC fragments (based on the reference genome) and should be used for all subsequent analysis. The other ratio file contains the coverageBed bins (i.e. 75nt bins by default) and may be useful for data representation.</p>

<p>The pipeline script can output the final ratio files in BedGraph format if the --bedgraph command-line switch is used.</p>

<p>Either file can be converted to .tdf format for viewing in IGV via the gff2tdf.pl script.</p>
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/owenjm">owenjm</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>